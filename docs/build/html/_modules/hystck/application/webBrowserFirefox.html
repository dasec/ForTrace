
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>fortrace.application.webBrowserFirefox &#8212; fortrace  documentation</title>
    <link rel="stylesheet" href="../../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
   
  <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for fortrace.application.webBrowserFirefox</h1><div class="highlight"><pre>
<span></span><span class="c1"># Copyright (C) 2017 Sascha Kopp</span>
<span class="c1"># This file is part of fortrace - http://fortrace.fbi.h-da.de</span>
<span class="c1"># See the file &#39;docs/LICENSE&#39; for copying permission.</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">logging</span>
    <span class="kn">import</span> <span class="nn">sys</span>
    <span class="kn">import</span> <span class="nn">platform</span>
    <span class="kn">import</span> <span class="nn">threading</span>
    <span class="kn">import</span> <span class="nn">subprocess</span>
    <span class="kn">import</span> <span class="nn">inspect</span>  <span class="c1"># for listing all method of a class</span>
    <span class="kn">import</span> <span class="nn">os</span>
    <span class="kn">import</span> <span class="nn">time</span>

    <span class="c1"># base class VMM side</span>
    <span class="kn">from</span> <span class="nn">fortrace.application.application</span> <span class="k">import</span> <span class="n">ApplicationVmmSide</span>
    <span class="kn">from</span> <span class="nn">fortrace.application.application</span> <span class="k">import</span> <span class="n">ApplicationVmmSideCommands</span>

    <span class="c1"># base class guest side</span>
    <span class="kn">from</span> <span class="nn">fortrace.application.application</span> <span class="k">import</span> <span class="n">ApplicationGuestSide</span>
    <span class="kn">from</span> <span class="nn">fortrace.application.application</span> <span class="k">import</span> <span class="n">ApplicationGuestSideCommands</span>
    <span class="kn">from</span> <span class="nn">fortrace.utility.line</span> <span class="k">import</span> <span class="n">lineno</span>

    <span class="c1"># marionette helper</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">from</span> <span class="nn">fortrace.utility.marionette_helper</span> <span class="k">import</span> <span class="n">MarionetteHelper</span>
        <span class="kn">from</span> <span class="nn">fortrace.utility.marionette_helper</span> <span class="k">import</span> <span class="n">DEFAULT_FF_PATH_WIN32</span>
        <span class="kn">from</span> <span class="nn">fortrace.utility.marionette_helper</span> <span class="k">import</span> <span class="n">DEFAULT_FF_PATH_WIN64</span>
        <span class="kn">from</span> <span class="nn">fortrace.utility.marionette_helper</span> <span class="k">import</span> <span class="n">DEFAULT_FF64_PATH_WIN</span>
        <span class="kn">from</span> <span class="nn">fortrace.utility.marionette_helper</span> <span class="k">import</span> <span class="n">DEFAULT_FF_PATH_LINUX</span>
    <span class="k">except</span> <span class="ne">ImportError</span> <span class="k">as</span> <span class="n">ie1</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Import error in webBrowserFirefox.py for marionette helper classes.&quot;</span><span class="p">)</span>

    <span class="c1">#pywinauto enter button</span>
    <span class="kn">from</span> <span class="nn">pywinauto</span> <span class="k">import</span> <span class="n">keyboard</span>

<span class="k">except</span> <span class="ne">ImportError</span> <span class="k">as</span> <span class="n">ie</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Import error! in webBrowserFirefox.py &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ie</span><span class="p">))</span>
    <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>


<span class="c1">###############################################################################</span>
<span class="c1"># Host side implementation</span>
<span class="c1">###############################################################################</span>
<div class="viewcode-block" id="WebBrowserFirefoxVmmSide"><a class="viewcode-back" href="../../../developer/functions.html#fortrace.application.webBrowserFirefox.WebBrowserFirefoxVmmSide">[docs]</a><span class="k">class</span> <span class="nc">WebBrowserFirefoxVmmSide</span><span class="p">(</span><span class="n">ApplicationVmmSide</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class is a remote control on the host-side to control a real browser</span>
<span class="sd">    running on a guest. Supported browsers on the guest is Mozilla Firefox.</span>
<span class="sd">    For more details to the correspond guest-side module look into</span>
<span class="sd">    webBrowserFirefox_guest_side.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">guest_obj</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Set default attribute values only.</span>
<span class="sd">        @param guest_obj: The guest on which this browser is running. (will be inserted from guest::application())</span>
<span class="sd">        @param args: containing</span>
<span class="sd">                web_browser : Type of the webBrowserFirefox (currently firefox is</span>
<span class="sd">                    tested).</span>
<span class="sd">                 logger: Logger name for logging.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">WebBrowserFirefoxVmmSide</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">guest_obj</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;function: WebBrowserFirefoxVmmSide::__init__&quot;</span><span class="p">)</span>
            <span class="c1"># surf the url through the socket.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">webBrowserFirefox</span> <span class="o">=</span> <span class="s2">&quot;Firefox&quot;</span>
            <span class="c1"># the current link which was surfed</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">window_id</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="n">lineno</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot; Error: webBrowserFirefoxHostSide::__init__ &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">guest_obj</span><span class="o">.</span><span class="n">guestname</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>

<div class="viewcode-block" id="WebBrowserFirefoxVmmSide.open"><a class="viewcode-back" href="../../../developer/functions.html#fortrace.application.webBrowserFirefox.WebBrowserFirefoxVmmSide.open">[docs]</a>    <span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sends a command to open a webBrowserFirefox on the associated guest.</span>

<span class="sd">        @param url: Website to open.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># store the current window_id from the guest object as this browser window_id,</span>
        <span class="c1"># start the browser and</span>
        <span class="c1"># increment the window id from the guest object</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;function: WebBrowserFirefoxVmmSide::open&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="n">url</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">window_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">guest_obj</span><span class="o">.</span><span class="n">current_window_id</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">guest_obj</span><span class="o">.</span><span class="n">send</span><span class="p">(</span>
                <span class="s2">&quot;application &quot;</span> <span class="o">+</span> <span class="s2">&quot;webBrowserFirefox &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">window_id</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; open &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">webBrowserFirefox</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">url</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">guest_obj</span><span class="o">.</span><span class="n">current_window_id</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;error WebBrowserFirefoxVmmSide::open: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span></div>

<div class="viewcode-block" id="WebBrowserFirefoxVmmSide.close"><a class="viewcode-back" href="../../../developer/functions.html#fortrace.application.webBrowserFirefox.WebBrowserFirefoxVmmSide.close">[docs]</a>    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sends a command to close a webBrowserFirefox on the associated guest.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;function: WebBrowserFirefoxVmmSide::close&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">guest_obj</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s2">&quot;application &quot;</span> <span class="o">+</span> <span class="s2">&quot;webBrowserFirefox &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">window_id</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; close &quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;error WebBrowserFirefoxVmmSide:close()&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span></div>

<div class="viewcode-block" id="WebBrowserFirefoxVmmSide.browse_to"><a class="viewcode-back" href="../../../developer/functions.html#fortrace.application.webBrowserFirefox.WebBrowserFirefoxVmmSide.browse_to">[docs]</a>    <span class="k">def</span> <span class="nf">browse_to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sends a url to the associated webBrowserFirefox running on the guest.</span>
<span class="sd">        @param url: URL to load.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;function: WebBrowserFirefoxVmmSide::browse_to&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">guest_obj</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s2">&quot;application &quot;</span> <span class="o">+</span> <span class="s2">&quot;webBrowserFirefox &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">window_id</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; browse_to &quot;</span> <span class="o">+</span> <span class="n">url</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">is_busy</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;error WebBrowserFirefoxVmmSide::browse_to: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span></div>

    <span class="k">def</span> <span class="nf">download_from</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">selector</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">guest_obj</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s2">&quot;application &quot;</span> <span class="o">+</span> <span class="s2">&quot;webBrowserFirefox &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">window_id</span><span class="p">)</span> <span class="o">+</span>
                                <span class="s2">&quot; download_from &quot;</span> <span class="o">+</span> <span class="n">url</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">selector</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">is_busy</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;error WebBrowserFirefoxVmmSide::download_from: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>

<div class="viewcode-block" id="WebBrowserFirefoxVmmSide.browse_to_link_number"><a class="viewcode-back" href="../../../developer/functions.html#fortrace.application.webBrowserFirefox.WebBrowserFirefoxVmmSide.browse_to_link_number">[docs]</a>    <span class="k">def</span> <span class="nf">browse_to_link_number</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">link_number</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Call the &lt;linkNumber&gt; link on the current website in the browser.</span>
<span class="sd">        @param link_number: number of the link on this website to call.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;function: WebBrowserFirefoxVmmSide::browse_to_link_number&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">guest_obj</span><span class="o">.</span><span class="n">send</span><span class="p">(</span>
                <span class="s2">&quot;application &quot;</span> <span class="o">+</span> <span class="s2">&quot;webBrowserFirefox &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">window_id</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; browse_to_link_number &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">link_number</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">is_busy</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;error WebBrowserFirefoxVmmSide::browse_to_link_number: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span></div>

<div class="viewcode-block" id="WebBrowserFirefoxVmmSide.send_keys_to_browser_element"><a class="viewcode-back" href="../../../developer/functions.html#fortrace.application.webBrowserFirefox.WebBrowserFirefoxVmmSide.send_keys_to_browser_element">[docs]</a>    <span class="k">def</span> <span class="nf">send_keys_to_browser_element</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">element</span><span class="p">,</span> <span class="n">keys</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Send keys to a specific element on the currently parsed website.</span>
<span class="sd">        @param element: element to search for.</span>
<span class="sd">        @param keys: string for the element</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;function: WebBrowserFirefoxVmmSide::send_keys_to_browser_element&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">guest_obj</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s2">&quot;application &quot;</span> <span class="o">+</span> <span class="s2">&quot;webBrowserFirefox &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">window_id</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; send_keys_to_browser_element&quot;</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">element</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">keys</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;error WebBrowserFirefoxVmmSide::send_keys_to_browser_element: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span></div>

    <span class="k">def</span> <span class="nf">click_element_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
        <span class="c1">#experimental</span>
        <span class="k">try</span><span class="p">:</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">guest_obj</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s2">&quot;application &quot;</span> <span class="o">+</span> <span class="s2">&quot;webBrowserFirefox &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
	         <span class="bp">self</span><span class="o">.</span><span class="n">window_id</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; click_element_test&quot;</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nb">id</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;error WebBrowserFirefoxVmmSide::click_element_test: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">click_xpath_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xpath</span><span class="p">):</span>
	<span class="c1">#experimental</span>
	<span class="k">try</span><span class="p">:</span>
	     <span class="bp">self</span><span class="o">.</span><span class="n">guest_obj</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s2">&quot;application &quot;</span> <span class="o">+</span> <span class="s2">&quot;webBrowserFirefox &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
		 <span class="bp">self</span><span class="o">.</span><span class="n">window_id</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; click_xpath_test&quot;</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">xpath</span><span class="p">)</span>
	<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
	    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;error WebBrowserFirefoxVmmSide::click_xpath_test: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">press_enter_test</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
	<span class="c1">#experimental</span>
	<span class="k">try</span><span class="p">:</span>
	    <span class="bp">self</span><span class="o">.</span><span class="n">guest_obj</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s2">&quot;application &quot;</span> <span class="o">+</span> <span class="s2">&quot;webBrowserFirefox &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">window_id</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; press_enter_test &quot;</span><span class="p">)</span>
	<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
	    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;error WebBrowserFirefoxVmmSide::press_enter_test: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">save_as</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1">#experimental</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">guest_obj</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s2">&quot;application &quot;</span> <span class="o">+</span> <span class="s2">&quot;webBrowserFirefox &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">window_id</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; save_as &quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;error WebBrowserFirefoxVmmSide::save_as: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>

<div class="viewcode-block" id="WebBrowserFirefoxVmmSide.facebook_login"><a class="viewcode-back" href="../../../developer/functions.html#fortrace.application.webBrowserFirefox.WebBrowserFirefoxVmmSide.facebook_login">[docs]</a>    <span class="k">def</span> <span class="nf">facebook_login</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sends a command to call facebook.com and login.</span>
<span class="sd">        @param username: facebook username.</span>
<span class="sd">        @param password: facebook password.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;function: WebBrowserFirefoxVmmSide::facebook_login&quot;</span><span class="p">)</span>
            <span class="c1">##### deprecated code section: calls other hostside functions</span>
            <span class="c1">#self.browse_to(&quot;www.facebook.com&quot;)</span>
            <span class="c1">#self.send_keys_to_browser_element(&quot;email&quot;, username)</span>
            <span class="c1">#self.send_keys_to_browser_element(&quot;pass&quot;, password)</span>
	    <span class="c1">#time.sleep(20)</span>
	    <span class="c1">#self.click_element_test(id)</span>

            <span class="c1">#new hostside implementation</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">guest_obj</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s2">&quot;application &quot;</span> <span class="o">+</span> <span class="s2">&quot;webBrowserFirefox &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">windows_id</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; facebook_login&quot;</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">username</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">password</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nb">id</span><span class="p">)</span>

           <span class="c1"># self.send_keys_to_browser_element(&quot; pass&quot;, &quot;{ENTER}&quot;)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;error WebBrowserFirefoxVmmSide::facebook_login: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span></div></div>


<span class="c1">###############################################################################</span>
<span class="c1"># Commands to parse on host side</span>
<span class="c1">###############################################################################</span>
<span class="k">class</span> <span class="nc">WebBrowserFirefoxVmmSideCommands</span><span class="p">(</span><span class="n">ApplicationVmmSideCommands</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class with all commands for webBrowserFirefox which will be received from the agent on the guest.</span>

<span class="sd">    Static only.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">commands</span><span class="p">(</span><span class="n">guest_obj</span><span class="p">,</span> <span class="n">cmd</span><span class="p">):</span>
        <span class="c1"># cmd[0] = win_id; cmd[1] = state</span>
        <span class="n">module_name</span> <span class="o">=</span> <span class="s2">&quot;webBrowserFirefox&quot;</span>
        <span class="n">guest_obj</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;WebBrowserFirefoxVmmSideCommands::commands: &quot;</span> <span class="o">+</span> <span class="n">cmd</span><span class="p">)</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="n">cmd</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;opened&quot;</span> <span class="ow">in</span> <span class="n">cmd</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">guest_obj</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;in opened&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">guest_obj</span><span class="o">.</span><span class="n">applicationWindow</span><span class="p">[</span><span class="n">module_name</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">cmd</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="nb">str</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">window_id</span><span class="p">):</span>
                        <span class="n">guest_obj</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;window_id: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">window_id</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; found!&quot;</span><span class="p">)</span>
                        <span class="n">guest_obj</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">module_name</span> <span class="o">+</span> <span class="s2">&quot; with id: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">window_id</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; is_opened = true&quot;</span><span class="p">)</span>
                        <span class="n">obj</span><span class="o">.</span><span class="n">is_opened</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="n">guest_obj</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;browser_obj.is_opened is True now!&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="s2">&quot;busy&quot;</span> <span class="ow">in</span> <span class="n">cmd</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">guest_obj</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;in busy&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">guest_obj</span><span class="o">.</span><span class="n">applicationWindow</span><span class="p">[</span><span class="n">module_name</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">cmd</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="nb">str</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">window_id</span><span class="p">):</span>
                        <span class="n">guest_obj</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">module_name</span> <span class="o">+</span> <span class="s2">&quot; with id: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">window_id</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; is_busy = true&quot;</span><span class="p">)</span>
                        <span class="n">obj</span><span class="o">.</span><span class="n">is_busy</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">if</span> <span class="s2">&quot;ready&quot;</span> <span class="ow">in</span> <span class="n">cmd</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">guest_obj</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;in ready&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">guest_obj</span><span class="o">.</span><span class="n">applicationWindow</span><span class="p">[</span><span class="n">module_name</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">cmd</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="nb">str</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">window_id</span><span class="p">):</span>
                        <span class="n">guest_obj</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">module_name</span> <span class="o">+</span> <span class="s2">&quot; with id: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">window_id</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; is_busy = false&quot;</span><span class="p">)</span>
                        <span class="n">obj</span><span class="o">.</span><span class="n">is_busy</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="k">if</span> <span class="s2">&quot;error&quot;</span> <span class="ow">in</span> <span class="n">cmd</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">guest_obj</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;in error&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">guest_obj</span><span class="o">.</span><span class="n">applicationWindow</span><span class="p">[</span><span class="n">module_name</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="n">cmd</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="nb">str</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">window_id</span><span class="p">):</span>
                        <span class="n">guest_obj</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">module_name</span> <span class="o">+</span> <span class="s2">&quot; with id: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">window_id</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; has_error = True&quot;</span><span class="p">)</span>
                        <span class="n">obj</span><span class="o">.</span><span class="n">has_error</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">module_name</span> <span class="o">+</span> <span class="s2">&quot;_host_side_commands::commands &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>


<span class="c1">###############################################################################</span>
<span class="c1"># Guest side implementation</span>
<span class="c1">###############################################################################</span>
<span class="k">class</span> <span class="nc">WebBrowserFirefoxGuestSide</span><span class="p">(</span><span class="n">ApplicationGuestSide</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;webBrowserFirefox implementation of the guest side.</span>

<span class="sd">    Usually Windows, Linux guest&#39;s</span>
<span class="sd">    class attributes</span>
<span class="sd">    browserType - Which browser have to be used for surfing (firefox, chrome...)</span>
<span class="sd">    window_id - The ID for the opened object</span>
<span class="sd">    url - which have to be opened / is opened</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">agent_obj</span><span class="p">,</span> <span class="n">logger</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">WebBrowserFirefoxGuestSide</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">agent_obj</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">browserType</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">last_driven_url</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">last_browser_type</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">module_name</span> <span class="o">=</span> <span class="s2">&quot;webBrowserFirefox&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">window_is_crushed</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">window_id</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">agent_object</span> <span class="o">=</span> <span class="n">agent_obj</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">helper</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ffpath</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ffpath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_firefox_path</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">helper</span> <span class="o">=</span> <span class="n">MarionetteHelper</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ffpath</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Error in &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span>
                            <span class="s2">&quot;: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Open a browser and save the webBrowserFirefox object with an id in a dictionary.</span>
<span class="sd">        Set page load timeout to 30 seconds.</span>

<span class="sd">        return:</span>
<span class="sd">            Send to the host in the known to be good state:</span>
<span class="sd">                &#39;application webBrowserFirefox window_id open&#39;.</span>
<span class="sd">                &#39;application webBrowserFirefox window_id ready&#39;.</span>
<span class="sd">            in the error state:</span>
<span class="sd">                &#39;application webBrowserFirefox window_id error&#39;.</span>
<span class="sd">            additionally the &#39;window_is_crushed&#39; attribute is set; so the next</span>
<span class="sd">            call will open a new window.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">arguments</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
            <span class="n">web_browser</span> <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">url</span> <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="mi">30</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">module_name</span> <span class="o">+</span> <span class="s2">&quot;GuestSide::open&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">last_driven_url</span> <span class="o">=</span> <span class="n">url</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;URL to call: &quot;</span> <span class="o">+</span> <span class="n">url</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;open url: &quot;</span> <span class="o">+</span> <span class="n">url</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">helper</span><span class="o">.</span><span class="n">run_firefox</span><span class="p">()</span>  <span class="c1"># start ff session</span>

            <span class="n">retval</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">helper</span><span class="o">.</span><span class="n">navigate_to_url</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>  <span class="c1"># browse to the specified url</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">retval</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;could not open url&quot;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">agent_object</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s2">&quot;application &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">module_name</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">window_id</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; opened&quot;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">agent_object</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s2">&quot;application &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">module_name</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">window_id</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; ready&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">window_is_crushed</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;WebBrowserFirefoxGuestSide::open: Close all open browsers and clear the webBrowserFirefox list&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">helper</span><span class="o">.</span><span class="n">quit_firefox</span><span class="p">()</span>
            <span class="c1"># for browserObject in self.agent_object.applicationWindow[self.module_name]:</span>
            <span class="c1">#    self.agent_obj.applicationWindow[self.module_name].remove(browserObject)</span>
            <span class="c1"># set a crushed flag.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">window_is_crushed</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">agent_object</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s2">&quot;application &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">module_name</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">window_id</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; error&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error in &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s2">&quot;::open&quot;</span> <span class="o">+</span> <span class="s2">&quot;: selenium is crushed: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Close one given browser by window_id</span>

<span class="sd">        @param args: Not used, only inserted for the generic function</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span>
                         <span class="s2">&quot;::close &quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">helper</span><span class="o">.</span><span class="n">quit_firefox</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">browse_to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Will browse to the url with the browser window which have the given window_id</span>

<span class="sd">        Send to the host in the known to be good state:</span>
<span class="sd">            &#39;browserInfo busy window_id&#39;   before load the website.</span>
<span class="sd">            &#39;browserInfo ready window_id&#39;  if load is finished.</span>
<span class="sd">        in the error state:</span>
<span class="sd">            &#39;browserInfo error window_id&#39;  if selenium will throw an exception.</span>
<span class="sd">        additionally the &#39;window_is_crushed&#39; attribute is set; so the next</span>
<span class="sd">        browse call will open a new window.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">last_driven_url</span> <span class="o">=</span> <span class="n">url</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">agent_object</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s2">&quot;application &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">module_name</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">window_id</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; busy&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;open url: &quot;</span> <span class="o">+</span> <span class="n">url</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">helper</span><span class="o">.</span><span class="n">navigate_to_url</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">agent_object</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s2">&quot;application &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">module_name</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">window_id</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; ready&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">window_is_crushed</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;WebBrowserFirefoxGuestSide::browse_to: Close all open browsers and clear the webBrowserFirefox list&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">helper</span><span class="o">.</span><span class="n">quit_firefox</span><span class="p">()</span>
            <span class="c1"># for browserObject in self.agent_object.applicationWindow[self.module_name]:</span>
            <span class="c1">#    self.agent_obj.applicationWindow[self.module_name].remove(browserObject)</span>
            <span class="c1"># set a crushed flag.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">window_is_crushed</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">agent_object</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s2">&quot;application &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">module_name</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">window_id</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; error&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error in &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s2">&quot;::open&quot;</span> <span class="o">+</span> <span class="s2">&quot;: selenium is crushed: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">download_from</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function will download something from url where selector will be the selector of the download button</span>
<span class="sd">        At the moment it will only work if the file type is set to automatic download in firefox on the base image.</span>
<span class="sd">        Added by Thomas Schaefer in 2019</span>
<span class="sd">        :param url: website where we want to download from</span>
<span class="sd">        :param selector: css selector of the download button</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">arguments</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
            <span class="n">url</span> <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">selector</span> <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">last_driven_url</span> <span class="o">=</span> <span class="n">url</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;downloading from: &quot;</span> <span class="o">+</span> <span class="n">url</span> <span class="o">+</span> <span class="s2">&quot;; With the selector: &quot;</span> <span class="o">+</span> <span class="n">selector</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">helper</span><span class="o">.</span><span class="n">navigate_to_url</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">helper</span><span class="o">.</span><span class="n">click_element_by_id</span><span class="p">(</span><span class="n">selector</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">window_is_crushed</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">window_is_crushed</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error: &quot;</span> <span class="o">+</span> <span class="n">lineno</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">browse_to_link_number</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">link_number</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Parse the website to find &lt;a&gt; elements which represent a link.</span>

<span class="sd">        Sends a busy and ready message to the VMM.</span>
<span class="sd">        It surf the linkNumbers link by clicking it.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;function: browse_to_link_number&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">agent_object</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s2">&quot;application &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">module_name</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">window_id</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; busy&quot;</span><span class="p">)</span>
            <span class="n">retval</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">helper</span><span class="o">.</span><span class="n">follow_link</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">link_number</span><span class="p">))</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">retval</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Could not open link&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">agent_object</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s2">&quot;application &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">module_name</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">window_id</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; ready&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">window_is_crushed</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;WebBrowserFirefoxGuestSide::browse_to_link_nuber: Close all open browsers and clear the &quot;</span> <span class="o">+</span> <span class="s2">&quot;webBrowserFirefox list&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">helper</span><span class="o">.</span><span class="n">quit_firefox</span><span class="p">()</span>
            <span class="c1"># for browserObject in self.agent_object.applicationWindow[self.module_name]:</span>
            <span class="c1">#    self.agent_obj.applicationWindow[self.module_name].remove(browserObject)</span>
            <span class="c1"># set a crushed flag.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">window_is_crushed</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">agent_object</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s2">&quot;application &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">module_name</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">window_id</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; error&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error in &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s2">&quot;::open&quot;</span> <span class="o">+</span> <span class="s2">&quot;: selenium is crushed: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">browse_to_link_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">link_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Parse the website to find &lt;a&gt; elements which represent a link.</span>
<span class="sd">        Sends a busy and ready message to the host</span>
<span class="sd">        Then it surf the linkNumbers link by clicking it.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">agent_object</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s2">&quot;application &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">module_name</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">window_id</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; busy&quot;</span><span class="p">)</span>
            <span class="n">retval</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">helper</span><span class="o">.</span><span class="n">click_element_by_link_text</span><span class="p">(</span><span class="n">link_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">retval</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;could not open link&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">agent_object</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s2">&quot;application &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">module_name</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">window_id</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; ready&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">window_is_crushed</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="s2">&quot;WebBrowserFirefoxGuestSide::browse_to_link_name: Close all open browsers and clear the &quot;</span> <span class="o">+</span> <span class="s2">&quot;webBrowserFirefox list&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">helper</span><span class="o">.</span><span class="n">quit_firefox</span><span class="p">()</span>
            <span class="c1"># for browserObject in self.agent_object.applicationWindow[self.module_name]:</span>
            <span class="c1">#    self.agent_obj.applicationWindow[self.module_name].remove(browserObject)</span>
            <span class="c1"># set a crushed flag.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">window_is_crushed</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">agent_object</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s2">&quot;application &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">module_name</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">window_id</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; error&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error in &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">+</span> <span class="s2">&quot;::open&quot;</span> <span class="o">+</span> <span class="s2">&quot;: selenium is crushed: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">send_keys_to_browser_element</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Send Keys to an browser element, searched by selenium.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">arguments</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
            <span class="n">element</span> <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">keys</span> <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">agent_object</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s2">&quot;application &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">module_name</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">window_id</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; busy&quot;</span><span class="p">)</span>
            <span class="c1">#elem = self.seleniumDriver.find_element_by_name(element)</span>
            <span class="c1">#key_string = translate_winKeys_to_seleniumKeys(keys)</span>
            <span class="c1">#elem.send_keys(key_string)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">helper</span><span class="o">.</span><span class="n">send_keys_to_element_by_name</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">keys</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">agent_object</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s2">&quot;application &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">module_name</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">window_id</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; ready&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">module_name</span> <span class="o">+</span> <span class="s2">&quot; error &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">window_id</span><span class="p">)</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">agent_object</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s2">&quot;application &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">module_name</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">window_id</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; error&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">facebook_login</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
        <span class="c1">#experimental, todo: include &quot;busy&quot; and &quot;ready&quot; states and to be tested</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">arguments</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
            <span class="c1">#username = &quot;email&quot; + &quot; &quot; + arguments[0]</span>
            <span class="c1">#password = &quot;pass&quot; + &quot; &quot; + arguments[1]</span>
            <span class="n">username</span> <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">password</span> <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="nb">id</span> <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;facebook.com&quot;</span>
            <span class="c1">#todo include busy and ready states from here</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">browse_to</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
            <span class="c1">#self.send_keys_to_browser_element(username)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">agent_object</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s2">&quot;application &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">module_name</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">window_id</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; busy&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">helper</span><span class="o">.</span><span class="n">send_keys_to_element_by_name</span><span class="p">(</span><span class="s2">&quot;email&quot;</span><span class="p">,</span> <span class="n">username</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">agent_object</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s2">&quot;application &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">module_name</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">window_id</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; ready&quot;</span><span class="p">)</span>
            <span class="c1">#self.send_keys_to_browser_element(password)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">agent_object</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s2">&quot;application &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">module_name</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">window_id</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; busy&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">helper</span><span class="o">.</span><span class="n">send_keys_to_element_by_name</span><span class="p">(</span><span class="s2">&quot;pass&quot;</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">agent_object</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s2">&quot;application &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">module_name</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">window_id</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; ready&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">click_element_test</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">module_name</span> <span class="o">+</span> <span class="s2">&quot; error &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">window_id</span><span class="p">)</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">agent_object</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s2">&quot;application &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">module_name</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">window_id</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; error&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">click_element_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
	<span class="c1">#experimental; rename + busy/ready states</span>
        <span class="n">element</span> <span class="o">=</span> <span class="nb">id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">helper</span><span class="o">.</span><span class="n">click_element_by_id</span><span class="p">(</span><span class="n">element</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">click_xpath_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xpath</span><span class="p">):</span>
	<span class="c1">#experimental; rename + busy/ready states</span>
	<span class="n">xelement</span> <span class="o">=</span> <span class="n">xpath</span>
	<span class="bp">self</span><span class="o">.</span><span class="n">helper</span><span class="o">.</span><span class="n">click_element_by_xpath</span><span class="p">(</span><span class="n">xelement</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">press_enter_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
	<span class="c1">#experimental; rename + busy/ready states</span>
	<span class="n">keyboard</span><span class="o">.</span><span class="n">SendKeys</span><span class="p">(</span><span class="s1">&#39;{ENTER 2}&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">save_as</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
        <span class="c1">#experimental, to be tested; busy/ready states</span>
        <span class="n">keyboard</span><span class="o">.</span><span class="n">SendKeys</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">find_firefox_path</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;Windows&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">DEFAULT_FF64_PATH_WIN</span>  <span class="c1"># assume 64bit FF on Win64 for now, mozilla changed to 64bit on win64</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">DEFAULT_FF_PATH_LINUX</span>


<span class="c1">###############################################################################</span>
<span class="c1"># Commands to parse on guest side</span>
<span class="c1">###############################################################################</span>
<span class="k">class</span> <span class="nc">WebBrowserFirefoxGuestSideCommands</span><span class="p">(</span><span class="n">ApplicationGuestSideCommands</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class with all commands for one application.</span>

<span class="sd">    call the ask method for an object. The call will be done by a thread, so if the timeout is</span>
<span class="sd">    reached, the open application will be closed and opened again.</span>
<span class="sd">    Static only.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">commands</span><span class="p">(</span><span class="n">agent_obj</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">cmd</span><span class="p">):</span>  <span class="c1"># commands(obj, cmd) obj from list objlist[window_id] win id in cmd[1]?</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">agent_obj</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;static function WebBrowserFirefoxGuestSideCommands::commands&quot;</span><span class="p">)</span>
            <span class="n">agent_obj</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;command to parse: &quot;</span> <span class="o">+</span> <span class="n">cmd</span><span class="p">)</span>
            <span class="n">com</span> <span class="o">=</span> <span class="n">cmd</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">com</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">args</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">com</span><span class="p">[</span><span class="mi">3</span><span class="p">:])</span>

            <span class="n">module</span> <span class="o">=</span> <span class="n">com</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># inspect.stack()[-1][1].split(&quot;.&quot;)[0]</span>
            <span class="n">window_id</span> <span class="o">=</span> <span class="n">com</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">method_string</span> <span class="o">=</span> <span class="n">com</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

            <span class="n">method_found</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">methods</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getmembers</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">predicate</span><span class="o">=</span><span class="n">inspect</span><span class="o">.</span><span class="n">ismethod</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">method</span> <span class="ow">in</span> <span class="n">methods</span><span class="p">:</span>
                <span class="c1"># method[0] will now contain the name of the method</span>
                <span class="c1"># method[1] will contain the value</span>

                <span class="k">if</span> <span class="n">method</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">method_string</span><span class="p">:</span>
                    <span class="c1"># start methods as threads</span>
                    <span class="n">method_found</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="n">agent_obj</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;method to call: &quot;</span> <span class="o">+</span> <span class="n">method</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;(&quot;</span> <span class="o">+</span> <span class="n">args</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span><span class="p">)</span>
                    <span class="n">agent_obj</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;args&quot;</span><span class="p">)</span>
                    <span class="n">tmp_thread</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">method</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">args</span><span class="p">,))</span>
                    <span class="n">agent_obj</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;thread is defined&quot;</span><span class="p">)</span>
                    <span class="n">tmp_thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
                    <span class="n">agent_obj</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;thread started&quot;</span><span class="p">)</span>
                    <span class="n">tmp_thread</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>  <span class="c1"># Wait until the thread is completed</span>
                    <span class="k">if</span> <span class="n">tmp_thread</span><span class="o">.</span><span class="n">isAlive</span><span class="p">():</span>
                        <span class="n">agent_obj</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;thread is alive... time outed&quot;</span><span class="p">)</span>
                        <span class="c1"># close open tasks (browser...)</span>
                        <span class="c1"># Todo close open function and windows</span>
                        <span class="n">agent_obj</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                            <span class="s2">&quot;WebBrowserFirefoxGuestSideCommands::commands: Close all open browsers and &quot;</span> <span class="o">+</span> <span class="s2">&quot;clear the webBrowserFirefox list&quot;</span><span class="p">)</span>
                        <span class="c1">#TODO: test</span>
                        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">methods</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;close&quot;</span><span class="p">:</span>
                                <span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">]()</span>  <span class="c1"># call close method for safe quiting</span>
                        <span class="c1">#if platform.system() == &quot;Windows&quot;:</span>
                        <span class="c1">#    subprocess.call([&quot;taskkill&quot;, &quot;/IM&quot;, &quot;firefox.exe&quot;, &quot;/F&quot;])</span>
                        <span class="c1">#elif platform.system() == &quot;Linux&quot;:</span>
                        <span class="c1">#    os.system(&quot;pkill firefox&quot;)</span>
                        <span class="c1">#else:</span>
                        <span class="c1">#    raise NotImplemented(&quot;Not implemented for system: &quot; + platform.system())</span>
                        <span class="c1"># for browserObject in agent_obj.applicationWindow[module]:</span>
                        <span class="c1">#    agent_obj.applicationWindow[module].remove(browserObject)</span>
                        <span class="c1"># set a crushed flag.</span>
                        <span class="n">obj</span><span class="o">.</span><span class="n">is_opened</span> <span class="o">=</span> <span class="kc">False</span>
                        <span class="n">obj</span><span class="o">.</span><span class="n">is_busy</span> <span class="o">=</span> <span class="kc">False</span>
                        <span class="n">obj</span><span class="o">.</span><span class="n">has_error</span> <span class="o">=</span> <span class="kc">True</span>

                        <span class="n">agent_obj</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;application &quot;</span> <span class="o">+</span> <span class="n">module</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">window_id</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; error&quot;</span><span class="p">)</span>
                        <span class="n">agent_obj</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s2">&quot;application &quot;</span> <span class="o">+</span> <span class="n">module</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">window_id</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; error&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">method_found</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Method &quot;</span> <span class="o">+</span> <span class="n">method_string</span> <span class="o">+</span> <span class="s2">&quot; is not defined!&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Error in WebBrowserFirefoxGuestSideCommands::commands &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../index.html">fortrace</a></h1>








<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../architecture/index.html">Architecture of fortrace</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../architecture/framework_architecture.html">Framework Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../architecture/generator.html">Generator</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../architecture/service_vm.html">Service VM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../installation/index.html">Installation of fortrace</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../installation/config.html">Configuration of installation options</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../installation/host.html">Host Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../installation/guest.html">Guest Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../installation/service_vm.html">Installation of Service VM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../installation/firstrun.html">First Run after installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../developer/index.html">Developer reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../developer/functions.html">Functions of fortrace</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../developer/implementing.html">Implementation of Scenarios</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../developer/implementing.html#implementation-of-new-features">Implementation of new Features</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../index.html">Documentation overview</a><ul>
  <li><a href="../../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2020, Thomas Schäfer, Thomas Göbel, Jan Türr.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.8.5</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
    </div>

    

    
  </body>
</html>